name: Keep Site Alive

on:
  schedule:
    # Run daily at 12:00 UTC (convert to your preferred time if needed)
    - cron: '0 12 * * *'
  workflow_dispatch: # Allows manual triggering from GitHub Actions tab

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Production Site
        run: |
          echo "Pinging production site to keep it active..."

          # Ping the main site
          echo "Testing main site..."
          curl -f -s -o /dev/null -w "Main site: HTTP %{http_code} - %{time_total}s\n" \
            https://warehouse-capacity-app.duckdns.org || echo "Main site ping failed"

          # Ping the health endpoint
          echo "Testing health endpoint..."
          curl -f -s -o /dev/null -w "Health check: HTTP %{http_code} - %{time_total}s\n" \
            https://warehouse-capacity-app.duckdns.org/health || echo "Health check failed"

          # Ping the API
          echo "Testing API..."
          curl -f -s -o /dev/null -w "API: HTTP %{http_code} - %{time_total}s\n" \
            https://warehouse-capacity-app.duckdns.org/api/v1 || echo "API ping failed"

          echo "Keep-alive pings completed successfully!"

      - name: Check Site Status
        run: |
          # Get a simple response to verify the site is working
          response=$(curl -s -o /dev/null -w "%{http_code}" https://warehouse-capacity-app.duckdns.org)

          if [ "$response" = "200" ] || [ "$response" = "301" ] || [ "$response" = "302" ]; then
            echo "✅ Site is UP (HTTP $response)"
          else
            echo "⚠️  Site returned HTTP $response"
            exit 1
          fi
